#!/data/data/com.termux/files/usr/bin/bash

echo "--- âš™ï¸ Mengonfigurasi Auto-Start Remote Agent ---"

# 1. Bersihkan script boot lama & file lama agar bersih
rm -f ~/.termux/boot/start_node.sh
rm -f ~/.termux/boot/start_agent.sh
rm -f /data/data/com.termux/files/home/remote_agent

# 2. DOWNLOAD FILE (Sesuai link yang kamu kirim)
# Disimpan dengan nama 'remote_agent' di folder home
echo "ğŸ“¥ Mengunduh remote_agent..."
curl -o /data/data/com.termux/files/home/remote_agent https://raw.githubusercontent.com/abinoldi/muffzle/refs/heads/main/remote_agent.sh

# 3. Pastikan folder boot ada
mkdir -p ~/.termux/boot/

# 4. Membuat file pemicu boot
# Saya sesuaikan perintah run-nya jadi 'bash remote_agent' (bukan 'bash agent')
cat << 'EOF' > ~/.termux/boot/start_agent.sh
#!/data/data/com.termux/files/usr/bin/sh

# Mencegah CPU tidur (PENTING)
termux-wake-lock

# Tunggu 20 detik agar sistem & internet siap
sleep 20

# Pindah ke direktori home dulu
cd /data/data/com.termux/files/home/

# Jalankan remote_agent dan simpan log
bash remote_agent > /sdcard/randserv_boot.log 2>&1 &
EOF

# 5. Memberikan izin eksekusi (Permission)
chmod +x ~/.termux/boot/start_agent.sh
# Pastikan file yang baru didownload bisa dieksekusi
chmod +x /data/data/com.termux/files/home/remote_agent

echo "--- âœ… Setup Selesai! ---"
echo "File 'remote_agent' akan dijalankan otomatis setiap reboot."
echo "Log akan disimpan di: /sdcard/randserv_boot.log"
